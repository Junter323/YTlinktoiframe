<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube 連結 ➜ iframe 產生器</title>
  <!-- 最新 Bootstrap 5（CDN） -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="row g-4">
      <div class="col-12">
        <h1 class="h3 fw-bold">YouTube 連結 ➜ iframe 產生器</h1>
        <p class="text-secondary mb-0">貼上任何 YouTube 連結（含 <code>watch</code>、<code>youtu.be</code>、<code>shorts</code>、播放清單），一鍵轉成可嵌入的 <code>&lt;iframe&gt;</code>。支援時間戳（<code>?t=90</code>、<code>?t=1m30s</code>）。</p>
      </div>

      <!-- 左側：輸入 & 設定 -->
      <div class="col-12 col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body">
            <!-- 基本輸入 -->
            <div class="mb-3">
              <label for="ytUrl" class="form-label">YouTube 網址</label>
              <button class="btn btn-sm btn-outline-secondary" id="btnPaste" type="button" title="從剪貼簿貼到上方網址">貼上</button>
              <div class="input-group">
                <input type="url" class="form-control" id="ytUrl" placeholder="例如：https://www.youtube.com/watch?v=amlJDZd_iew" />
                <!-- 移除貼上按鈕，避免擁擠 -->
                <button class="btn btn-outline-danger" id="btnClear" type="button" title="清除輸入與預覽">清除</button>
                <button class="btn btn-primary" id="btnGenerate" type="button">產生</button>
              </div>
              <div class="form-text">可直接貼上 YouTube App 分享的連結。若裝置允許，可按「貼上」按鈕自動從剪貼簿讀取。</div>
            </div>

            <!-- 進階設定（預設收合） -->
            <div class="mb-2 d-flex align-items-center justify-content-between">
              <h2 class="h6 mb-0">進階設定</h2>
              <a class="small text-decoration-none" data-bs-toggle="collapse" href="#advanced" role="button" aria-expanded="false" aria-controls="advanced">展開 / 收合</a>
            </div>
            <div class="collapse" id="advanced">
              <div class="border rounded p-3 bg-light-subtle">
                <div class="row g-3">
                  <div class="col-6 col-md-4">
                    <label class="form-label" for="width">寬度</label>
                    <input type="number" class="form-control" id="width" value="560" min="200" step="10" />
                  </div>
                  <div class="col-6 col-md-4">
                    <label class="form-label" for="height">高度</label>
                    <input type="number" class="form-control" id="height" value="315" min="150" step="5" />
                  </div>
                  <div class="col-12 col-md-4 d-flex align-items-end">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="responsive" checked />
                      <label class="form-check-label" for="responsive">響應式（16:9）</label>
                    </div>
                  </div>
                </div>

                <div class="row g-3 mt-1">
                  <div class="col-6 col-md-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="autoplay" />
                      <label class="form-check-label" for="autoplay">自動播放</label>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="mute" />
                      <label class="form-check-label" for="mute">靜音</label>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="rel" />
                      <label class="form-check-label" for="rel">關閉推薦影片（rel=0）</label>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="controls" checked />
                      <label class="form-check-label" for="controls">顯示控制列</label>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <hr class="my-4" />

            <!-- 輸出與工具列 -->
            <div class="mb-2 d-flex align-items-center gap-2 flex-wrap">
              <h2 class="h6 mb-0">輸出程式碼</h2>
              <button class="btn btn-sm btn-outline-secondary" id="btnCopy" type="button" title="複製下方輸出程式碼">複製</button>
            </div>
            <textarea class="form-control" id="output" rows="6" readonly></textarea>
          </div>
        </div>
      </div>

      <!-- 右側：預覽 -->
      <div class="col-12 col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="h6">即時預覽</h2>
            <div id="previewWrap" class="ratio ratio-16x9 bg-dark bg-opacity-10 d-flex align-items-center justify-content-center rounded">
              <span class="text-secondary">產生後會在這裡顯示預覽</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- 工具函式：解析秒數（支援 1h2m3s / 90 / 1m30s ） ---
    function parseTimeToSeconds(value) {
      if (!value) return 0;
      if (/^\d+$/.test(value)) return parseInt(value, 10);
      const match = value.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/i);
      if (!match) return 0;
      const h = parseInt(match[1] || '0', 10);
      const m = parseInt(match[2] || '0', 10);
      const s = parseInt(match[3] || '0', 10);
      return h * 3600 + m * 60 + s;
    }

    // --- 解析 YouTube 連結：支援 watch / youtu.be / shorts / playlist ---
    function parseYouTubeUrl(input) {
      try {
        const url = new URL(input);
        const host = url.hostname.replace(/^www\./, '');
        const path = url.pathname;
        const search = url.searchParams;

        // 先處理播放清單
        const list = search.get('list');
        if (list) {
          const startSeconds = parseTimeToSeconds(search.get('t') || search.get('start'));
          return { type: 'playlist', listId: list, start: startSeconds };
        }

        let videoId = '';
        if (host === 'youtube.com' || host === 'm.youtube.com' || host === 'music.youtube.com' || host === 'gaming.youtube.com') {
          if (path === '/watch') {
            videoId = search.get('v') || '';
          } else if (path.startsWith('/shorts/')) {
            videoId = path.split('/')[2] || '';
          } else if (path.startsWith('/embed/')) {
            videoId = path.split('/')[2] || '';
          }
        } else if (host === 'youtu.be') {
          videoId = path.slice(1);
        }

        if (videoId) {
          const startSeconds = parseTimeToSeconds(search.get('t') || search.get('start'));
          return { type: 'video', videoId, start: startSeconds };
        }

        return null;
      } catch (e) {
        return null;
      }
    }

    function buildEmbedUrl(parsed, opts) {
      const params = new URLSearchParams();
      if (opts.autoplay) params.set('autoplay', '1');
      if (opts.mute) params.set('mute', '1');
      if (!opts.controls) params.set('controls', '0');
      if (opts.rel) params.set('rel', '0');
      if (parsed.start) params.set('start', String(parsed.start));

      if (parsed.type === 'playlist') {
        const base = 'https://www.youtube.com/embed/videoseries';
        params.set('list', parsed.listId);
        return `${base}?${params.toString()}`;
      } else {
        const base = `https://www.youtube.com/embed/${parsed.videoId}`;
        const q = params.toString();
        return q ? `${base}?${q}` : base;
      }
    }

    function buildIframeCode(src, width, height, responsive) {
      const allow = [
        'accelerometer',
        'autoplay',
        'clipboard-write',
        'encrypted-media',
        'gyroscope',
        'picture-in-picture',
        'web-share'
      ].join('; ');

      const iframe = `<iframe width="${width}" height="${height}" src="${src}" title="YouTube video player" frameborder="0" allow="${allow}" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
      if (!responsive) return iframe;
      return `<div class=\"ratio ratio-16x9\">\n  ${iframe}\n</div>`;
    }

    function showPreview(code) {
      const wrap = document.getElementById('previewWrap');
      wrap.innerHTML = code;
    }

    function generate() {
      const urlInput = document.getElementById('ytUrl').value.trim();
      const width = parseInt(document.getElementById('width').value, 10) || 560;
      const height = parseInt(document.getElementById('height').value, 10) || 315;
      const responsive = document.getElementById('responsive').checked;
      const autoplay = document.getElementById('autoplay').checked;
      const mute = document.getElementById('mute').checked;
      const rel = document.getElementById('rel').checked;
      const controls = document.getElementById('controls').checked;

      const parsed = parseYouTubeUrl(urlInput);
      const output = document.getElementById('output');

      if (!parsed) {
        output.value = '';
        showPreview('<div class="text-danger">無法辨識的 YouTube 連結，請再確認。</div>');
        return;
      }

      const src = buildEmbedUrl(parsed, { autoplay, mute, rel, controls });
      const code = buildIframeCode(src, width, height, responsive);
      output.value = code;
      showPreview(code);
    }

    function showToast(message, variant = 'success') {
      const toastEl = document.createElement('div');
      toastEl.className = `toast align-items-center text-bg-${variant} border-0 position-fixed bottom-0 end-0 m-3`;
      toastEl.setAttribute('role', 'alert');
      toastEl.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      `;
      document.body.appendChild(toastEl);
      const toast = new bootstrap.Toast(toastEl, { delay: 2000 });
      toast.show();
      toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
    }

    function copyOutput() {
      const ta = document.getElementById('output');
      if (!ta.value) return;
      navigator.clipboard.writeText(ta.value).then(() => {
        showToast('已複製完成！', 'success');
      }).catch(() => {
        showToast('複製失敗，請手動選取複製。', 'danger');
      });
    }

    async function pasteFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        if (!text) {
          showToast('剪貼簿沒有內容。', 'warning');
          return;
        }
        const input = document.getElementById('ytUrl');
        input.value = text.trim();
        // 若看起來是 YouTube 連結就自動產生
        if (/youtu(\.be|be\.com)/i.test(input.value)) {
          generate();
        } else {
          showToast('已貼上，但不是 YouTube 連結。', 'warning');
        }
      } catch (err) {
        showToast('無法讀取剪貼簿，請手動貼上。', 'warning');
      }
    }

    function clearAll() {
      document.getElementById('ytUrl').value = '';
      document.getElementById('output').value = '';
      // 還原預覽區佈局與提示文字
      const wrap = document.getElementById('previewWrap');
      wrap.innerHTML = '<span class="text-secondary">產生後會在這裡顯示預覽</span>';
      document.getElementById('ytUrl').focus();
      showToast('已清除輸入與預覽。', 'info');
    }

    document.getElementById('btnGenerate').addEventListener('click', generate);
    document.getElementById('btnCopy').addEventListener('click', copyOutput);
    document.getElementById('btnPaste').addEventListener('click', pasteFromClipboard);
    document.getElementById('btnClear').addEventListener('click', clearAll);

    // Enter 快捷鍵：在輸入框按 Enter 直接產生
    document.getElementById('ytUrl').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        generate();
      }
    });

    // 範例預填
    document.getElementById('ytUrl').value = 'https://www.youtube.com/watch?v=amlJDZd_iew';
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
